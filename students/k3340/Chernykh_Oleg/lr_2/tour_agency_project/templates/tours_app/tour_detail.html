{% extends 'tours_app/base.html' %}

{% block title %}{{ tour.title }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <div class="mb-4">
            <span class="badge bg-primary mb-2">üìç {{ tour.country }}</span>
            <h1>{{ tour.title }}</h1>
        </div>
        <div class="card mb-4">
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <p><strong>üè¢ –¢—É—Ä–∞–≥–µ–Ω—Å—Ç–≤–æ:</strong> {{ tour.agency }}</p>
                        <p><strong>üìÖ –ü–µ—Ä–∏–æ–¥ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:</strong><br>
                        {{ tour.start_date|date:"d.m.Y" }} - {{ tour.end_date|date:"d.m.Y" }}</p>
                    </div>
                    <div class="col-md-6 text-end">
                        <span class="badge bg-success fs-4 p-3">
                            üí∞ {{ tour.price }} —Ä—É–±.
                        </span>
                    </div>
                </div>
                <hr>
                <p><strong>üìù –û–ø–∏—Å–∞–Ω–∏–µ:</strong></p>
                <p class="mb-4">{{ tour.description }}</p>
                <p><strong>üí≥ –£—Å–ª–æ–≤–∏—è –æ–ø–ª–∞—Ç—ã:</strong></p>
                <p>{{ tour.payment_terms }}</p>
            </div>
        </div>

        <!-- –û—Ç–∑—ã–≤—ã -->
        <h3 class="mt-5">üí¨ –û—Ç–∑—ã–≤—ã</h3>
        {% if reviews %}
            {% for review in reviews %}
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="card-title mb-0">
                                <strong>üë§ {{ review.user.username }}</strong>
                            </h6>
                            <span class="badge bg-warning text-dark fs-6">
                                ‚≠ê {{ review.rating }}/10
                            </span>
                        </div>
                        <p class="text-muted small mb-2">
                            üìÖ –î–∞—Ç–∞ —Ç—É—Ä–∞: {{ review.tour_date|date:"d.m.Y" }}
                        </p>
                        <p class="card-text">{{ review.text }}</p>
                        <small class="text-muted">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ: {{ review.created_at|date:"d.m.Y H:i" }}</small>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="alert alert-info">
                <p class="mb-0">–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
            </div>
        {% endif %}

        {% if user.is_authenticated %}
            {% if not user_review %}
                <a href="{% url 'create_review' tour.pk %}" class="btn btn-success mt-3">–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</a>
            {% else %}
                <div class="alert alert-info mt-3">–í—ã —É–∂–µ –æ—Å—Ç–∞–≤–∏–ª–∏ –æ—Ç–∑—ã–≤ –∫ —ç—Ç–æ–º—É —Ç—É—Ä—É.</div>
            {% endif %}
        {% endif %}
    </div>

    <div class="col-md-4">
        {% if user.is_authenticated %}
            {% if user_reservation %}
                <div class="card sticky-top" style="top: 20px;">
                    <div class="card-body text-center">
                        <h5 class="card-title mb-3">‚úÖ –í–∞—à–µ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ</h5>
                        <p class="mb-2">
                            <strong>–°—Ç–∞—Ç—É—Å:</strong><br>
                            {% if user_reservation.confirmed %}
                                <span class="badge bg-success fs-6 mt-2">‚úì –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ</span>
                            {% else %}
                                <span class="badge bg-warning fs-6 mt-2">‚è≥ –û–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</span>
                            {% endif %}
                        </p>
                        <hr>
                        <p class="text-muted small mb-3">
                            üìÖ –î–∞—Ç–∞ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è:<br>
                            {{ user_reservation.reservation_date|date:"d.m.Y H:i" }}
                        </p>
                        <a href="{% url 'my_reservations' %}" class="btn btn-primary w-100">–ú–æ–∏ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è</a>
                    </div>
                </div>
            {% else %}
                <div class="card sticky-top" style="top: 20px;">
                    <div class="card-body text-center">
                        <h5 class="card-title mb-3">üé´ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ç—É—Ä</h5>
                        <p class="text-muted mb-4">–ó–∞–±—Ä–æ–Ω–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç —Ç—É—Ä –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!</p>
                        <a href="{% url 'create_reservation' tour.pk %}" class="btn btn-primary btn-lg w-100">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</a>
                    </div>
                </div>
            {% endif %}
        {% else %}
            <div class="card sticky-top" style="top: 20px;">
                <div class="card-body text-center">
                    <h5 class="card-title mb-3">üîê –î–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h5>
                    <p class="text-muted mb-4">–í–æ–π–¥–∏—Ç–µ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å, —á—Ç–æ–±—ã –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ç—É—Ä</p>
                    <a href="{% url 'register' %}" class="btn btn-primary w-100 mb-2">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                    <a href="{% url 'login' %}" class="btn btn-outline-primary w-100">–í–æ–π—Ç–∏</a>
                </div>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

